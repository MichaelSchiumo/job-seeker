{"ast":null,"code":"import _regeneratorRuntime from\"/Users/michael/Desktop/contact-keeper/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/michael/Desktop/contact-keeper/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/michael/Desktop/contact-keeper/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthContext from'./AuthContext';import AuthReducer from'./authReducer';import axios from'axios';import setAuthToken from'../../utils/setAuthToken';import{REGISTER_SUCCESS,REGISTER_FAIL,USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from'../types.js';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem('token'),isAuthenticated:null,loading:true,error:null,user:null};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];//   REGISTER User\nvar register=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData){var config,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config={headers:{'Content-Type':'application/json'}};_context.prev=1;_context.next=4;return axios.post('/api/users',formData,config);case 4:res=_context.sent;dispatch({type:REGISTER_SUCCESS,payload:res.data});loadUser();_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatch({type:REGISTER_FAIL,payload:_context.t0.response.data.msg});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function register(_x){return _ref.apply(this,arguments);};}();//  LOAD USER\nvar loadUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0://@todo - load token into global headers\nif(localStorage.token){setAuthToken(localStorage.token);}_context2.prev=1;_context2.next=4;return axios.get('/api/auth');case 4:res=_context2.sent;dispatch({type:USER_LOADED,payload:res.data});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);dispatch({type:AUTH_ERROR});case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function loadUser(){return _ref2.apply(this,arguments);};}();//   LOGIN USER\nvar login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData){var config,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:config={headers:{'Content-Type':'application/json'}};_context3.prev=1;_context3.next=4;return axios.post('/api/auth',formData,config);case 4:res=_context3.sent;dispatch({type:LOGIN_SUCCESS,payload:res.data});loadUser();_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](1);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response.data.msg});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[1,9]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();//   LOGOUT\nvar logout=function logout(){return dispatch({type:LOGOUT});};//   CLEAR ERRORS\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,register:register,loadUser:loadUser,clearErrors:clearErrors,logout:logout,login:login}},props.children);};export default AuthState;","map":{"version":3,"sources":["/Users/michael/Desktop/contact-keeper/client/src/context/auth/AuthState.js"],"names":["React","useReducer","AuthContext","AuthReducer","axios","setAuthToken","REGISTER_SUCCESS","REGISTER_FAIL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","error","user","state","dispatch","register","formData","config","headers","post","res","type","payload","data","loadUser","response","msg","get","login","logout","clearErrors","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport AuthContext from './AuthContext';\nimport AuthReducer from './authReducer';\nimport axios from 'axios';\nimport setAuthToken from '../../utils/setAuthToken';\n\nimport {\n  REGISTER_SUCCESS,\n  REGISTER_FAIL,\n  USER_LOADED,\n  AUTH_ERROR,\n  LOGIN_SUCCESS,\n  LOGIN_FAIL,\n  LOGOUT,\n  CLEAR_ERRORS,\n} from '../types.js';\n\nconst AuthState = (props) => {\n  const initialState = {\n    token: localStorage.getItem('token'),\n    isAuthenticated: null,\n    loading: true,\n    error: null,\n    user: null,\n  };\n\n  const [state, dispatch] = useReducer(AuthReducer, initialState);\n\n  //   REGISTER User\n\n  const register = async (formData) => {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    try {\n      const res = await axios.post('/api/users', formData, config);\n      dispatch({\n        type: REGISTER_SUCCESS,\n        payload: res.data,\n      });\n\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: REGISTER_FAIL,\n        payload: error.response.data.msg,\n      });\n    }\n  };\n\n  //  LOAD USER\n  const loadUser = async () => {\n    //@todo - load token into global headers\n    if (localStorage.token) {\n      setAuthToken(localStorage.token);\n    }\n\n    try {\n      const res = await axios.get('/api/auth');\n\n      dispatch({\n        type: USER_LOADED,\n        payload: res.data,\n      });\n    } catch (error) {\n      dispatch({ type: AUTH_ERROR });\n    }\n  };\n  //   LOGIN USER\n  const login = async (formData) => {\n    const config = {\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    };\n\n    try {\n      const res = await axios.post('/api/auth', formData, config);\n      dispatch({\n        type: LOGIN_SUCCESS,\n        payload: res.data,\n      });\n\n      loadUser();\n    } catch (error) {\n      dispatch({\n        type: LOGIN_FAIL,\n        payload: error.response.data.msg,\n      });\n    }\n  };\n  //   LOGOUT\n  const logout = () => dispatch({ type: LOGOUT });\n\n  //   CLEAR ERRORS\n  const clearErrors = () =>\n    dispatch({\n      type: CLEAR_ERRORS,\n    });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        token: state.token,\n        isAuthenticated: state.isAuthenticated,\n        loading: state.loading,\n        user: state.user,\n        error: state.error,\n        register,\n        loadUser,\n        clearErrors,\n        logout,\n        login,\n      }}\n    >\n      {props.children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthState;\n"]},"metadata":{},"sourceType":"module"}